<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Token Base Authentication · Diyalog</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Token base auth is system that customer can register into Diyalog sdk with their application User Info, and can chat between thier application user.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Token Base Authentication · Diyalog"/><meta property="og:type" content="website"/><meta property="og:url" content="https://diyalog-im.github.io/index.html"/><meta property="og:description" content="&lt;p&gt;Token base auth is system that customer can register into Diyalog sdk with their application User Info, and can chat between thier application user.&lt;/p&gt;
"/><meta property="og:image" content="https://diyalog-im.github.io/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://diyalog-im.github.io/img/docusaurus.png"/><link rel="shortcut icon" href="/img/favicon/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/big_logo_wihte.png" alt="Diyalog"/><h2 class="headerTitleWithLogo">Diyalog</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/en/GettingStarted/overview" target="_self">Docs</a></li><li class=""><a href="https://github.com/diyalog-im/diyalog-platform" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Android</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/docs/en/GettingStarted/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/en/GettingStarted/getstarted">Getting Started</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Android</h3><ul><li class="navListItem"><a class="navItem" href="/docs/en/Android/doc_getting_started">How to configure Diyalog</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/Android/tokenBaseAuth">Token Base Authentication</a></li><li class="navListItem"><a class="navItem" href="/docs/en/Android/doc_style">Diyalog Android SDK Style</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">iOS</h3><ul><li class="navListItem"><a class="navItem" href="/docs/en/iOS/iOS">How to configure Diyalog</a></li><li class="navListItem"><a class="navItem" href="/docs/en/iOS/TokenBaseAuthentication">Token Base Authentication</a></li><li class="navListItem"><a class="navItem" href="/docs/en/iOS/RichView">Richiew Notificaion Support</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Cordova plugin</h3><ul><li class="navListItem"><a class="navItem" href="/docs/en/cordovaPlugin/HowToUseCordova">How to add Cordova plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/en/cordovaPlugin/CreateCordovaPlugin/CreateCordovaPlugin">How to create Cordova plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/en/cordovaPlugin/CreateIonicProject/CreateIonicProject">How to create ionic project</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Web SDK</h3><ul><li class="navListItem"><a class="navItem" href="/docs/en/diyalogWebSdk/WebSdk">How to use WEB SDK</a></li><li class="navListItem"><a class="navItem" href="/docs/en/diyalogWebSdk/OpenDiyalogSDK/OpenDiyalogSDK">Use Web SDK Javascript from My Web App</a></li><li class="navListItem"><a class="navItem" href="/docs/en/diyalogWebSdk/OpenInDiyalogSDKAngularJSApp/OpenInDiyalogSDKAngularJSApp">Use Web SDK from AngularJS Web App</a></li><li class="navListItem"><a class="navItem" href="/docs/en/diyalogWebSdk/OpenInIFrame/OpenInIFrame">Add Web App to an IFrame</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Messaging API</h3><ul><li class="navListItem"><a class="navItem" href="/docs/en/diyalog-messaging-api/diyalog-messaging-api">Messaging API Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Integration With Domain</h3><ul><li class="navListItem"><a class="navItem" href="/docs/en/diyalog-webhook-api/diyalog-webhook-api">Diyalog-Integration-With-Domain</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Token Base Authentication</h1></header><article><div><span><p>Token base auth is system that customer can register into Diyalog sdk with their application User Info, and can chat between thier application user.</p>
<p>With DiyalogSDK User can register in forground mode as well as background mode. Before authentication user need to init DiyalogSDK as below.</p>
<pre><code class="hljs css language-sh">   DiyalogEngine.diyalogInstance().Initialize(getApplicationContext());
   DiyalogEngine.diyalogInstance().waitForReady();
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="domain-customer-user"></a><a href="#domain-customer-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Domain Customer User</h2>
<p><strong>a. Foreground method</strong></br>
For customer user registration client need to call below method with necessary information. After successfully register on server it will create session in Diyalog SDK and can start messaging. Using below method if user already created session in Diyalog SDK, then it will directly open that session and user can start messaging.</p>
<pre><code class="hljs css language-sh"> DiyalogEngine.diyalogInstance().startTokenAuth(context,dlgToken,deviceId,
                               customerId,customerName, customerPhone, customerEmail); 
</code></pre>
<p><strong>context</strong> - Activity context</br>
<strong>dlgToken</strong> - Main application server will return Diyalog Token when user will login into main application</br>
<strong>DeviceId</strong> - domain specific device id. this is for domain validation</br>
<strong>CustId</strong> - domain customer id</br>
<strong>CustName</strong> - customer name</br>
<strong>CustPhone</strong> -  customer phone number (Optional)</br>
<strong>CustEmail</strong> – customer email address (Optional)</br></p>
<p><strong>b. Background method</strong></br>
When customer user will call background method then it will be register on server and after successfully register, it will create session into sdk.
And when user will click on Diyalog chat icon from main application to open sdk, it will directly open that session. user does not wait for register.
And In background method if there is any failure then it will pass error message into failure callback.</p>
<pre><code class="hljs css language-sh"> DiyalogEngine.diyalogInstance().startTokenAuthInBackground(context,dlgToken,deviceId,
                               customerId,customerName, customerPhone, customerEmail, new <span class="hljs-function"><span class="hljs-title">TokenAuthResponse</span></span>() {
                    @Override
                    public void <span class="hljs-function"><span class="hljs-title">success</span></span>() {
                        Log.e(<span class="hljs-string">"Auth In Bakground"</span>,<span class="hljs-string">"==&gt;&gt; Success "</span>);
                       
                    }

                    @Override
                    public void failure(TokenAuthError tokenAuthError) {
                        Log.e(<span class="hljs-string">"Auth In Bakground"</span>, <span class="hljs-string">"==&gt;&gt; Error Message: "</span> + tokenAuthError.getErrorMsg());
                        Log.e(<span class="hljs-string">"Auth In Bakground"</span>, <span class="hljs-string">"==&gt;&gt; Error Code: "</span>+  tokenAuthError.getErrorCode());
                    }
                }) ;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="domain-staff-user"></a><a href="#domain-staff-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Domain Staff User</h2>
<p><strong>a. Foreground method</strong></br>
For staff user registration client need to call below method with necessary information. After successfully register on server it will create session in Diyalog SDK and can start messaging. Using below method if user already created session in Diyalog SDK, then it will directly open that session and user can start messaging.</p>
<pre><code class="hljs css language-sh">   DiyalogEngine.diyalogInstance().startDomainUserTokenAuth( context,  dlgToken,   sessionId,
                                         userId,
                                         userName,
                                         userPhone,
                                         userEmail);
</code></pre>
<p><strong>context</strong> - Activity context</br>
<strong>dlgToken</strong> - Main application server will return Diyalog Token when user will login into main application</br>
<strong>sessionId</strong> – Staff user's sessionId </br>
<strong>userId</strong> - Staff user's UserID</br>
<strong>UserName</strong> - Staff user's UserName </br>
<strong>userPhone</strong>  - Staff user's PhoneNumber(Optional)</br>
<strong>userEmail</strong> - Staff user's EmailID (Optional)</br></p>
<p><strong>b. Background method</strong></br>
When staff user will call background method then it will be register on server and after successfully register, it will create session into sdk.
And when user will click on Diyalog chat icon from main application to open sdk, it will directly open that session. user does not wait for register.
And In background method if there is any failure then it will pass error message into failure callback.</p>
<pre><code class="hljs css language-sh"> DiyalogEngine.diyalogInstance().startDomainUserTokenAuthInBackground(context,  dlgToken,   sessionId, userId,
                                         userName, userPhone, userEmail, new <span class="hljs-function"><span class="hljs-title">TokenAuthResponse</span></span>() {
                    @Override
                    public void <span class="hljs-function"><span class="hljs-title">success</span></span>() {
                        Log.e(<span class="hljs-string">"Auth In Bakground"</span>,<span class="hljs-string">"==&gt;&gt; Success "</span>);
                       
                    }

                    @Override
                    public void failure(TokenAuthError tokenAuthError) {
                        Log.e(<span class="hljs-string">"Auth In Bakground"</span>, <span class="hljs-string">"==&gt;&gt; Error Message: "</span> + tokenAuthError.getErrorMsg());
                        Log.e(<span class="hljs-string">"Auth In Bakground"</span>, <span class="hljs-string">"==&gt;&gt; Error Code: "</span>+  tokenAuthError.getErrorCode());
                    }
                }) ;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="get-active-sessions"></a><a href="#get-active-sessions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get Active sessions</h2>
<p>User can get all sessions list those already registered in diyalog SDK. This method will be use for both Domain customer user and staff user.</p>
<pre><code class="hljs css language-sh">ArrayList&lt;AccountVo&gt; sessionList = DiyalogEngine.diyalogInstance().getActiveSessions();
</code></pre>
<p>This method will return list of saved session from sdk.
It will contain userInfo as below:</p>
<ul>
<li>ApplicationUserID</li>
<li>AuthID</li>
<li>UserName</li>
<li>User Image.</li>
<li>User is active or not</li>
<li>Unread message count</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="messaging-from-specific-user"></a><a href="#messaging-from-specific-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Messaging from specific User</h2>
<p>User can start messaging from specific user. If session already saved into Diyalog SDK then user can start messaging with thier UserID.</p>
<pre><code class="hljs css language-sh">DiyalogEngine.diyalogInstance().startMessagingWithUserId(context,customerId);
</code></pre>
<p><strong>context</strong> - Activity context</br>
<strong>customerId</strong> -  domain customer id</p>
<p>This method will be use for both Domain customer user and staff user.</p>
<h2><a class="anchor" aria-hidden="true" id="delete-session-of-user"></a><a href="#delete-session-of-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delete session of user</h2>
<p>Client can delete session of diyalog sdk for any user.</p>
<pre><code class="hljs css language-sh">boolean isDelted = DiyalogEngine.diyalogInstance().deleteSessionOfUser(customerId); 
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="get-total-unread-count-into-main-application"></a><a href="#get-total-unread-count-into-main-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get total unread count into main application.</h2>
<p>Client can get total no of unread message count into main application, so they can set unread badge count into main application. Client need to subscribe unread count event as below:</p>
<pre><code class="hljs css language-sh"> DiyalogEngine.diyalogInstance().subscribeToTotalUnreadCountEvent(new ValueChangedListener&lt;Integer&gt;() {
                    @Override
                    public void onChanged(Integer val, Value&lt;Integer&gt; valueModel) {
                        unreadCount.setText(String.valueOf(val));  // unreadCount is textview <span class="hljs-keyword">for</span> display unread message count.
                    }
                });

</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/Android/doc_getting_started"><span class="arrow-prev">← </span><span>How to configure Diyalog</span></a><a class="docs-next button" href="/docs/en/Android/doc_style"><span>Diyalog Android SDK Style</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#domain-customer-user">Domain Customer User</a></li><li><a href="#domain-staff-user">Domain Staff User</a></li><li><a href="#get-active-sessions">Get Active sessions</a></li><li><a href="#messaging-from-specific-user">Messaging from specific User</a></li><li><a href="#delete-session-of-user">Delete session of user</a></li><li><a href="#get-total-unread-count-into-main-application">Get total unread count into main application.</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/favicon.png" alt="Diyalog" width="66" height="52"/></a><div><h5>Docs</h5><a href="/docs/en/GettingStarted/overview">Getting Started</a><a href="/docs/en/Android/doc_getting_started">Android</a><a href="/docs/en/iOS/iOS">iOS</a><a href="/docs/en/cordovaPlugin/HowToUseCordova">Cordova plugin</a><a href="/docs/en/diyalogWebSdk/WebSdk">Web SDK</a><a href="/docs/en/diyalog-messaging-api/diyalog-messaging-api">Messaging API</a><a href="/docs/en/diyalog-webhook-api/diyalog-webhook-api">Integration With Domain</a></div><div><h5>Community</h5><a href="https://landing.diyalog.im/#features" target="_blank" rel="noreferrer noopener">User Features</a><a href="https://landing.diyalog.im/#whyus" target="_blank" rel="noreferrer noopener">Why Diyalog</a><a href="https://landing.diyalog.im/#packages" target="_blank" rel="noreferrer noopener">packages</a><a href="https://landing.diyalog.im/#apisection" target="_blank" rel="noreferrer noopener">Dialog API and SDK</a><a href="https://landing.diyalog.im/#contact" target="_blank" rel="noreferrer noopener">contact</a></div><div><h5>More</h5><a href="https://github.com/diyalog-im/diyalog-platform" target="_blank" rel="noreferrer noopener">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright"><div>Copyright © 2019 Diyalog - All Rights Reserved</div><div><a href="/docs/en/privacy_terms/privacy">Privacy  &amp; Terms</a></div></section></footer></div></body></html>