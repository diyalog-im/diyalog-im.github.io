(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{139:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"Highlight",(function(){return s})),n.d(t,"HighlightWithBlack",(function(){return p})),n.d(t,"HighlightWithRed",(function(){return b})),n.d(t,"ColoredText",(function(){return u})),n.d(t,"CenteredText",(function(){return d})),n.d(t,"GreenColoredText",(function(){return m})),n.d(t,"BlueColoredText",(function(){return h})),n.d(t,"toc",(function(){return g})),n.d(t,"default",(function(){return f}));var r,a=n(3),o=n(7),l=(n(0),n(152)),i=(n(153),{id:"android_online_help",title:"Starting Online Help",sidebar_label:"Online Help"}),c={unversionedId:"android_online_help",id:"android_online_help",isDocsHomePage:!1,title:"Starting Online Help",description:"<span",source:"@site/../docs/android_online_help.md",slug:"/android_online_help",permalink:"/docs/android_online_help",version:"current",sidebar_label:"Online Help",sidebar:"docs",previous:{title:"Starting Video Help",permalink:"/docs/android_video_help"},next:{title:"Token Base Authentication",permalink:"/docs/android_tokenBaseAuth"}},s=function(e){var t=e.children,n=e.color;return Object(l.b)("span",{style:{backgroundColor:n,borderRadius:"2px",color:"#fff",padding:"0.2rem"}},t)},p=function(e){var t=e.children,n=e.color;return Object(l.b)("span",{style:{backgroundColor:n,borderRadius:"2px",padding:"0.2rem"}},t)},b=function(e){var t=e.children,n=e.color;return Object(l.b)("span",{style:{color:"#d60b0b",backgroundColor:n,borderRadius:"2px",padding:"0.2rem"}},t)},u=function(e){var t=e.children,n=e.color;return Object(l.b)("span",{style:{color:n}},t)},d=function(e){var t=e.children;return Object(l.b)("span",{style:{align:"center"}},t)},m=function(e){var t=e.children;return Object(l.b)("span",{style:{color:"#42b72a"}},t)},h=function(e){var t=e.children;return Object(l.b)("span",{style:{color:"#1877F2"}},t)},g=[],O=(r="SmallText",function(e){return console.warn("Component "+r+" was not imported, exported, or provided by MDXProvider as global scope"),Object(l.b)("div",e)}),y={Highlight:s,HighlightWithBlack:p,HighlightWithRed:b,ColoredText:u,CenteredText:d,GreenColoredText:m,BlueColoredText:h,toc:g};function f(e){var t=e.components,r=Object(o.a)(e,["components"]);return Object(l.b)("wrapper",Object(a.a)({},y,r,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"Diyalog Platform provides live assistance service to your customers through your mobile application with messaging.  "),Object(l.b)("p",null,"You can download full simple online help android project from ",Object(l.b)("a",{parentName:"p",href:"https://diyalog.im/app/pkgs/demoapps/SimpleOnlineHelp.zip"},"SimpleOnlineHelp")," link.  "),Object(l.b)("p",null,"First of all, you need to know the flow about online help in Diyalog platform. "),Object(l.b)("p",null,"The flow is like below :"),Object(l.b)("p",null,Object(l.b)("img",{src:n(246).default})),Object(l.b)("p",null,"You should first create and get a transaction hash data in Diyalog server by calling Diyalog server's rest api from your application server. Diyalog server will create a transactionHash and then you could start an online help by using this transaction hash. This step is important for security.   "),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},"Your mobile app should call your application server to get transactionHash with the customer and device hash. "),Object(l.b)("li",{parentName:"ol"},"Your application server should create and get transactionHash in Diyalog Server by calling ",Object(l.b)("strong",{parentName:"li"},"gettransactionhashforonlinehelp")," rest api. Only server with valid credentials can call this api in Diyalog server and generate transactionHash. You can get the credential information for your server from the Diyalog admin.  "),Object(l.b)("li",{parentName:"ol"},"Diyalog server creates and return transactionHash to your server."),Object(l.b)("li",{parentName:"ol"},"Your app server return transactionHash to your mobile app."),Object(l.b)("li",{parentName:"ol"},"After getting transactionHash from the server, your mobile app can call ",Object(l.b)("strong",{parentName:"li"},"startAnonymousOnlineHelp")," method in the DiyalogSDK with it."),Object(l.b)("li",{parentName:"ol"},"DiyalogSDK call Diyalog server and initiate online help and then waits until other party (agent) to connect."),Object(l.b)("li",{parentName:"ol"},"Diyalog server create online help and then return OK to mobile app. If there is an error, server will return error to mobile app."),Object(l.b)("li",{parentName:"ol"},"DiyalodSDK will return response of ",Object(l.b)("strong",{parentName:"li"},"startAnonymousOnlineHelp")," method to your app. Then you can show wait screen in your app if you manage wait screen. If not, DiyalogSDK will show default wait screen.  "),Object(l.b)("li",{parentName:"ol"},"When this process starts, a request should have been sent to the call system queue for online help from your own system. When an agent (representative) open a customer from the queue, he initiates the online help chat with the customer through the Diyalog application.   "),Object(l.b)("li",{parentName:"ol"},"Diyalog server starts online help with each parties who are agent and customer."),Object(l.b)("li",{parentName:"ol"},'After online help startted with customer and agent. Diyalog SDK will send online help state to your app via callback function that you subcscribe. These states can be "STARTED", "CHAT_INPROGRESS", "CHAT_ENDED" and "N0_CHAT"'),Object(l.b)("li",{parentName:"ol"},"DiyalogSDK will update your app by all changings in the online help states.")),Object(l.b)("p",null,"An online help can be started at the relevant stage of your application as follows. When you call the following method, Diyalog first performs the necessary security checks for the relevant customer according to the transactionHash, deviceHash and customer number trio and starts the live help for the relevant customer. "),Object(l.b)("p",null,"Waiting screen should be shown to the customer until the live help is started by the customer representative. You can manage the waiting screen in your own application or use Diyalog SDK's waiting screen if you prefer.  "),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-jsx"},"public void startAnonymousOnlineHelp(\n        Activity context,\n        String customerId,\n        String customerName,\n        Long idNumber,\n        Long customerPhone,\n        String email,\n        OnlineHelpType helpType,\n        String transactionHash,\n        String waitDisplayText,\n        boolean isLoggedIn,\n        boolean isBackground,\n        OnlineHelpStartResult onlineHelpStartResult)\n")),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:"left"},"Parameters"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"context")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(Activity)")," ",Object(l.b)("br",null)," Activity that this method called from."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"customerId")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(String)")," Customer id number."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"customerName")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(String)")," Name of the customer."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"idNumber")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(Long)")," ",Object(l.b)("br",null),"National ID number of the customer. It is not must. You can set 0 for it."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"customerPhone")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(Long)")," ",Object(l.b)("br",null),"Opsiyoneldir. ",Object(l.b)("br",null),"Phone number of the customer. This paramater is optional. It can be set null."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"email")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(Long)")," ",Object(l.b)("br",null),"Optional ",Object(l.b)("br",null),"Email address of the customer. This paramater is optional. It can be set null."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"helpType")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(OnlineHelpType)")," This parameter is used to define help type. It can be OnlineHelpType.CHAT, OnlineHelpType.VIDEO_CALL, OnlineHelpType.VOICE_CALL."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"transactionHash")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(String)")," It is the transactionHash value that you create in the Dialog server through your own application server."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"waitDisplayText")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(String)")," ",Object(l.b)("br",null),"Optional ",Object(l.b)("br",null)," It is the text information that will be displayed on the waiting screen. This parameter is used only if Diyalog SDK will manage waiting screen."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"isLoggedIn")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(boolean)"),"It is the flag that show customer is logged in ot not into main app."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"isBackground")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(boolean)"),"It is the flag that show waiting screen will be managed by Diyalog SDK ot not."))),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:"left"},Object(l.b)(O,{mdxType:"SmallText"},Object(l.b)(h,{mdxType:"BlueColoredText"},"onlineHelpStartResult")," ",Object(l.b)(m,{mdxType:"GreenColoredText"},"(OnlineHelpStartResult)")," ",Object(l.b)("strong",{parentName:"td"},"startAnonymousOnlineHelp")," method is an asynchronous method and sends the result (information that the online help has been started) to your application with this callback method."))))),Object(l.b)("p",null,"You can find the detail about VideoCallResult class"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-jsx"},'public interface OnlineHelpStartResult {\n    void success();\n    void failure(OnlineHelpStartError onlineHelpStartError);\n}\n\npublic class OnlineHelpStartError {\n\n    public static final String CUSTOMERID_SHOULD_BE_PASSED = "DLGEXCPINP_CUSTOMER_ID";\n    public static final String EXCEPTION_IN_AUTH_REQUEST = "DLGEXCP_AUTH_REQUEST";\n    public static final String EXCEPTION_IN_COMPLETE_AUTH = "DLGEXCP_COMPLETE_AUTH";\n    public static final String EXCEPTION_IN_USER_IS_INCALL_NOW = "DLGEXCP_USER_IS_IN_CALL_NOW";\n    public static final String EXCEPTION_CUSTOMER_NOT_ACTIVE_IN_DEVICE = "DLGEXCP_CUSTOMER_NOT_ACTIVE_IN_DEVICE";\n    public static final String GENERAL_EXCEPTION = "DLGEXCP_GENERAL_EXCEPTION";\n\n    public static final String TRANSACTION_HASH_IS_EMPTY = "DLGEXCPINP_TRXHASH_IS_EMPTY";\n    public static final String INVALID_HELP_TYPE = "DLGEXCPINP_INVALID_HELP_TYPE";\n    public static final String CUSTOMER_NAME_IS_EMPTY = "DLGEXCPINP_CUSTOMER_NAME_IS_EMPTY";\n\n    public static final String NOT_SUPPORTED_FEATURE = "DLGEXCP_NOT_SUPPORTED_FEATURE";\n\n    private String errorCode;\n    private String errorMsg;\n\n    public OnlineHelpStartError(String errorCode, String errorMsg) {\n        this.errorCode = errorCode;\n        this.errorMsg = errorMsg;\n    }\n\n    public String getErrorCode() {\n        return errorCode;\n    }\n    public String getErrorMsg() {\n        return errorMsg;\n    }\n}\n')),Object(l.b)("p",null,"After getting success from ",Object(l.b)("strong",{parentName:"p"},"startAnonymousOnlineHelp")," method, you can listen state of online help by subscribing the onlineHelpState. You can use following method for it."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-jsx"},"public void subscribeToOnlineHelpChatStateEvent(ValueChangedListener<String> listener)\n")),Object(l.b)("p",null,"Online help state is a string and can have following values.  "),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"  ",Object(l.b)("strong",{parentName:"p"},'"NO_CHAT"'),"           : Default and initial value. There is no active chat.",Object(l.b)("br",{parentName:"p"}),"\n","",Object(l.b)("strong",{parentName:"p"},'"STARTED"'),"           : Online help started and Diyalog wait screen is shwing. If you handle wait screen, this state will not return.",Object(l.b)("br",{parentName:"p"}),"\n","",Object(l.b)("strong",{parentName:"p"},'"CHAT_INPROGRESS"'),"   : Agent ve customer started to conversation.",Object(l.b)("br",{parentName:"p"}),"\n","",Object(l.b)("strong",{parentName:"p"},'"CHAT_ENDED"'),"        : Conversation completed.  ")),Object(l.b)("p",null,"You can see complete code sample that you need to implement below."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-jsx"},'// 1. Get Diyalog device hash from Diyalog sdk\nString deviceHash = DiyalogEngine.diyalogInstance().getDeviceHash();\nLog.e("OnlineHelp", "deviceHash: " + deviceHash);\n\n// 2. Call Diyalog server gettransactionhashforonlinehelp service from your app server with customerId\n// and this deviceHash.\n// below code assume that transactionHash recieved from server.\nString transactionHash = "88828d22c3acbec026973b8f9ea1de785bc7cf6e";\n\nString customerId = "123456"; //Customer number\nString customerName = "Name of Customer"; // Name and surname\nLong customerIdCardNo = 0L;  // National id number. It is optional. You can set 0L.\nLong customerPhoneNumber = null; // Optional\nString customerEmail = null; // Optional\n\n// message in wait screen. If you handle wait screen in your app. You can set it null;\nString waitText = "Please wait. Our representative will start video call soon.";\n\nboolean isLoggin = false; // this parameter say user logged in to your app or not. Itis not processeing in Diyalog for now. It will be use later.\nboolean isBackground = true; // true : Your app handle wait screen. false: Diyalog will handle wait screen\n\n// 3. Call startAnonymousOnlineHelp\nDiyalogEngine.diyalogInstance().startAnonymousOnlineHelp(\n        MainActivity.this,\n        customerId,\n        customerName,\n        customerIdCardNo,\n        customerPhoneNumber,\n        customerEmail,\n        OnlineHelpType.CHAT,\n        transactionHash,\n        waitText,\n        isLoggin,\n        isBackground,\n        new OnlineHelpStartResult() {\n            @Override\n            public void success() {\n                Log.e("OnlineHelp", "online help call success");\n\n                showWait();\n                // Subscribe online help and hadle events\n                DiyalogEngine.diyalogInstance().subscribeToOnlineHelpChatStateEvent(new ValueChangedListener<String>() {\n                    @Override\n                    public void onChanged(String onlineHelpState, Value<String> value) {\n                        Log.e("OnlineHelp", "online help call state : " + onlineHelpState);\n\n                        // Online help states\n                        //"NO_CHAT"           : Default and initial value. There is no active chat\n                        //"STARTED"           : Online help started and Diyalog wait screen is shwing. If you handle wait screen, this state will not return.\n                        //"CHAT_INPROGRESS"   : Agent ve customer started to conversation.\n                        //"CHAT_ENDED"        : Conversation completed.\n\n                        if (onlineHelpState.equals("CHAT_ENDED")){\n                            showStartOnlineHelpAgain();\n                        }\n                    }\n                });\n\n            }\n\n            @Override\n            public void failure(OnlineHelpStartError onlineHelpStartError) {\n                Log.e("OnlineHelp", "online help failed with error : " + onlineHelpStartError.getErrorMsg());\n            }\n        });\n}\n')),Object(l.b)("p",null,"If ",Object(l.b)("strong",{parentName:"p"},"startAnonymousOnlineHelp")," method return successfull and you showed wait screen to customer and the customer press cancel button in your wait screen before agent start online help, you should call ",Object(l.b)("strong",{parentName:"p"},"closeMessaging")," method to stop process"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-jsx"},"DiyalogEngine.diyalogInstance().closeMessaging();\n")),Object(l.b)("p",null,"Done :)  "),Object(l.b)("p",null,"You can download full simple online help android project from ",Object(l.b)("a",{parentName:"p",href:"https://diyalog.im/app/pkgs/demoapps/SimpleOnlineHelp.zip"},"SimpleOnlineHelp")," link."))}f.isMDXComponent=!0},152:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=a.a.createContext({}),p=function(e){var t=a.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=p(e.components);return a.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=p(n),d=r,m=b["".concat(l,".").concat(d)]||b[d]||u[d]||o;return n?a.a.createElement(m,i(i({ref:t},s),{},{components:n})):a.a.createElement(m,i({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var s=2;s<o;s++)l[s]=n[s];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},153:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l}));var r=n(16),a=n(154);function o(){const{siteConfig:{baseUrl:e="/",url:t}={}}=Object(r.default)();return{withBaseUrl:(n,r)=>function(e,t,n,{forcePrependBaseUrl:r=!1,absolute:o=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if(Object(a.b)(n))return n;if(r)return t+n;const l=n.startsWith(t)?n:t+n.replace(/^\//,"");return o?e+l:l}(t,e,n,r)}}function l(e,t={}){const{withBaseUrl:n}=o();return n(e,t)}},154:function(e,t,n){"use strict";function r(e){return!0===/^(\w*:|\/\/)/.test(e)}function a(e){return void 0!==e&&!r(e)}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}))},246:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/AnonymousOnlineHelp-2db65e01652b16d00f4417c79f209005.png"}}]);