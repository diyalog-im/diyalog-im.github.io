(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{164:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=a.a.createContext({}),b=function(e){var t=a.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=b(e.components);return a.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),p=b(n),d=r,m=p["".concat(l,".").concat(d)]||p[d]||u[d]||o;return n?a.a.createElement(m,i(i({ref:t},s),{},{components:n})):a.a.createElement(m,i({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var s=2;s<o;s++)l[s]=n[s];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},165:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l}));var r=n(16),a=n(166);function o(){const{siteConfig:{baseUrl:e="/",url:t}={}}=Object(r.default)();return{withBaseUrl:(n,r)=>function(e,t,n,{forcePrependBaseUrl:r=!1,absolute:o=!1}={}){if(!n)return n;if(n.startsWith("#"))return n;if(Object(a.b)(n))return n;if(r)return t+n;const l=n.startsWith(t)?n:t+n.replace(/^\//,"");return o?e+l:l}(t,e,n,r)}}function l(e,t={}){const{withBaseUrl:n}=o();return n(e,t)}},166:function(e,t,n){"use strict";function r(e){return!0===/^(\w*:|\/\/)/.test(e)}function a(e){return void 0!==e&&!r(e)}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}))},199:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/AnonymousOnlineHelp-2db65e01652b16d00f4417c79f209005.png"},97:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return i})),n.d(t,"Highlight",(function(){return c})),n.d(t,"HighlightWithBlack",(function(){return s})),n.d(t,"HighlightWithRed",(function(){return b})),n.d(t,"ColoredText",(function(){return p})),n.d(t,"CenteredText",(function(){return u})),n.d(t,"GreenColoredText",(function(){return d})),n.d(t,"BlueColoredText",(function(){return m})),n.d(t,"SmallText",(function(){return h})),n.d(t,"toc",(function(){return g})),n.d(t,"default",(function(){return y}));var r=n(3),a=n(7),o=(n(0),n(164)),l=(n(165),{id:"ios_online_help",title:"Starting Online Help",sidebar_label:"Online Help"}),i={unversionedId:"ios_online_help",id:"ios_online_help",isDocsHomePage:!1,title:"Starting Online Help",description:"<span",source:"@site/../docs/ios_online_help.md",slug:"/ios_online_help",permalink:"/docs/ios_online_help",version:"current",sidebar_label:"Online Help",sidebar:"docs",previous:{title:"Starting Video Help",permalink:"/docs/ios_video_help"},next:{title:"Token-Based Authentication",permalink:"/docs/iOS_TokenBaseAuthentication"}},c=function(e){var t=e.children,n=e.color;return Object(o.b)("span",{style:{backgroundColor:n,borderRadius:"2px",color:"#fff",padding:"0.2rem"}},t)},s=function(e){var t=e.children,n=e.color;return Object(o.b)("span",{style:{backgroundColor:n,borderRadius:"2px",padding:"0.2rem"}},t)},b=function(e){var t=e.children,n=e.color;return Object(o.b)("span",{style:{color:"#d60b0b",backgroundColor:n,borderRadius:"2px",padding:"0.2rem"}},t)},p=function(e){var t=e.children,n=e.color;return Object(o.b)("span",{style:{color:n}},t)},u=function(e){var t=e.children;return Object(o.b)("span",{style:{align:"center"}},t)},d=function(e){var t=e.children;return Object(o.b)("span",{style:{color:"#42b72a"}},t)},m=function(e){var t=e.children;return Object(o.b)("span",{style:{color:"#1877F2"}},t)},h=function(e){var t=e.children;return Object(o.b)("span",{style:{fontSize:"smaller"}},t)},g=[],O={Highlight:c,HighlightWithBlack:s,HighlightWithRed:b,ColoredText:p,CenteredText:u,GreenColoredText:d,BlueColoredText:m,SmallText:h,toc:g};function y(e){var t=e.components,l=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},O,l,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Diyalog Platform provides live assistance service to your customers through your mobile application with messaging.  "),Object(o.b)("p",null,"You can download full simple online help android project from ",Object(o.b)("a",{parentName:"p",href:"https://web.diyalog.im/app/pkgs/demoapps/SimpleOnlineHelp_IOS.zip"},"SimpleOnlineHelp")," link.  "),Object(o.b)("p",null,"First of all, you need to know the flow about online help in Diyalog platform. "),Object(o.b)("p",null,"The flow is like below :"),Object(o.b)("p",null,Object(o.b)("img",{src:n(199).default})),Object(o.b)("p",null,"You should first create and get a transaction hash data in Diyalog server by calling Diyalog server's rest api from your application server. Diyalog server will create a transactionHash and then you could start an online help by using this transaction hash. This step is important for security.   "),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Your mobile app should call your application server to get transactionHash with the customer and device hash. "),Object(o.b)("li",{parentName:"ol"},"Your application server should create and get transactionHash in Diyalog Server by calling ",Object(o.b)("strong",{parentName:"li"},Object(o.b)("a",{parentName:"strong",href:"/docs/diyalog-application-api-gettransactionhashforonlinehelp"},"gettransactionhashforonlinehelp"))," rest api. Only server with valid credentials can call this api in Diyalog server and generate transactionHash. You can get the credential information for your server from the Diyalog admin.  "),Object(o.b)("li",{parentName:"ol"},"Diyalog server creates and return transactionHash to your server."),Object(o.b)("li",{parentName:"ol"},"Your app server return transactionHash to your mobile app."),Object(o.b)("li",{parentName:"ol"},"After getting transactionHash from the server, your mobile app can call ",Object(o.b)("strong",{parentName:"li"},"startAnonymousOnlineHelp")," method in the DiyalogSDK with it."),Object(o.b)("li",{parentName:"ol"},"DiyalogSDK call Diyalog server and initiate online help and then waits until other party (agent) to connect."),Object(o.b)("li",{parentName:"ol"},"Diyalog server create online help and then return OK to mobile app. If there is an error, server will return error to mobile app."),Object(o.b)("li",{parentName:"ol"},"DiyalodSDK will return response of ",Object(o.b)("strong",{parentName:"li"},"startAnonymousOnlineHelp")," method to your app. Then you can show wait screen in your app if you manage wait screen. If not, DiyalogSDK will show default wait screen.  "),Object(o.b)("li",{parentName:"ol"},"When this process starts, a request should have been sent to the call system queue for online help from your own system. When an agent (representative) open a customer from the queue, he initiates the online help chat with the customer through the Diyalog application.   "),Object(o.b)("li",{parentName:"ol"},"Diyalog server starts online help with each parties who are agent and customer."),Object(o.b)("li",{parentName:"ol"},'After online help startted with customer and agent. Diyalog SDK will send online help state to your app via callback function that you subcscribe. These states can be "STARTED", "CHAT_INPROGRESS", "CHAT_ENDED" and "N0_CHAT"'),Object(o.b)("li",{parentName:"ol"},"DiyalogSDK will update your app by all changings in the online help states.")),Object(o.b)("p",null,"An online help can be started at the relevant stage of your application as follows. When you call the following method, Diyalog first performs the necessary security checks for the relevant customer according to the transactionHash, deviceHash and customer number trio and starts the live help for the relevant customer. "),Object(o.b)("p",null,"Waiting screen should be shown to the customer until the live help is started by the customer representative. You can manage the waiting screen in your own application or use Diyalog SDK's waiting screen if you prefer.  "),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-jsx"},'    @objc open func startAnonymousOnlineHelp(\n        customerId : String,\n        customerName : String,\n        idNumber : Int64 = 0,\n        customerPhone : Int64 = 0,\n        email : String = "",\n        helpType : String,\n        transactionHash : String,\n        isLoggedIn : Bool,\n        isBackground : Bool,\n        waitDisplayText : String,\n        result: @escaping (Bool, ACOnlineHelpStartError?) -> Void)\n')),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",{parentName:"tr",align:"left"},"Parameters"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"customerId")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(String)")," Customer id number."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"customerName")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(String)")," Name of the customer."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"idNumber")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(Long)")," ",Object(o.b)("br",null),"National ID number of the customer. It is not must. You can set 0 for it."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"customerPhone")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(Long)")," ",Object(o.b)("br",null),"Opsiyoneldir. ",Object(o.b)("br",null),"Phone number of the customer. This paramater is optional. It can be set null."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"email")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(Long)")," ",Object(o.b)("br",null),"Optional ",Object(o.b)("br",null),"Email address of the customer. This paramater is optional. It can be set null."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"helpType")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(String)"),' This parameter is used to define help type. It can be "chat", "video_call", "voice_call".'))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"transactionHash")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(String)")," It is the transactionHash value that you create in the Dialog server through your own application server."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"waitDisplayText")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(String)")," ",Object(o.b)("br",null),"Optional ",Object(o.b)("br",null)," It is the text information that will be displayed on the waiting screen. This parameter is used only if Diyalog SDK will manage waiting screen."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"isLoggedIn")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(boolean)"),"It is the flag that show customer is logged in ot not into main app."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"isBackground")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(boolean)"),"It is the flag that show waiting screen will be managed by Diyalog SDK ot not."))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",{parentName:"tr",align:"left"},Object(o.b)(h,{mdxType:"SmallText"},Object(o.b)(m,{mdxType:"BlueColoredText"},"result")," ",Object(o.b)(d,{mdxType:"GreenColoredText"},"(Bool, ACOnlineHelpStartError?)")," ",Object(o.b)("strong",{parentName:"td"},"startAnonymousOnlineHelp")," method is an asynchronous method and sends the result (information that the online help has been started) to your application with this callback method. ",Object(o.b)("br",null)," If Bool value return true, the method successfull and means waiting in background to connect a repsresentative ",Object(o.b)("br",null),"If Bool value return false, the method failed. And You can check failure reason from ACOnlineHelpStartError"))))),Object(o.b)("p",null,"After getting success from ",Object(o.b)("strong",{parentName:"p"},"startAnonymousOnlineHelp")," method, you can listen state of online help by subscribing the onlineHelpState. You can use following method for it."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-jsx"},"@objc open func subscribeToOnlineHelpChatStateEvent(listener: @escaping (_ value: String) -> Void)\n")),Object(o.b)("p",null,"You can unsubscribe from the event with the following method."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-jsx"},"@objc open func unsubscribeToOnlineHelpChatStateEvent()\n")),Object(o.b)("p",null,"Online help state is a string and can have following values.  "),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"  ",Object(o.b)("strong",{parentName:"p"},'"NO_CHAT"'),"           : Default and initial value. There is no active chat.",Object(o.b)("br",{parentName:"p"}),"\n","",Object(o.b)("strong",{parentName:"p"},'"STARTED"'),"           : Online help started and Diyalog wait screen is shwing. If you handle wait screen, this state will not return.",Object(o.b)("br",{parentName:"p"}),"\n","",Object(o.b)("strong",{parentName:"p"},'"CHAT_INPROGRESS"'),"   : Agent ve customer started to conversation.",Object(o.b)("br",{parentName:"p"}),"\n","",Object(o.b)("strong",{parentName:"p"},'"CHAT_ENDED"'),"        : Conversation completed.  ")),Object(o.b)("p",null,"You can see complete code sample that you need to implement below."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-jsx"},'// 1. Get Diyalog device hash from Diyalog sdk\nlet deviceHash : String = DiyalogEngine.diyalogInstance().getDeviceHash();\nprint("deviceHash : \\(deviceHash)")\n\n// 2. Call Diyalog server gettransactionhashforonlinehelp service from your app server with customerId\n// and this deviceHash.\n// below code assume that transactionHash recieved from server.\nlet transactionHash : String = "4222f1c04f35dc6b419f4ef5a0c9f2aadc26fc34";\n\n\nlet customerId : String = "123458"\nlet customerName : String = "Name of Customer" // Name and surname\nlet customerIdNo : Int64 = Int64(0)  // National id number. It is optional. You can set 0L.\nlet customerPhoneNumber : Int64 = Int64(0) // Optional\nlet customerEmail : String = "" // Optional\nlet helpType : String = "chat" // "chat", "video_call", "voice_call"\n\n// message in wait screen. If you handle wait screen in your app. You can set it empty;\nlet waitDisplayText : String = "Please wait. Our representative will start video call soon."\n\nlet isLoggedIn : Bool = false; // this parameter say user logged in to your app or not. Itis not processeing in Diyalog for now. It will be use later.\nlet isBackground : Bool = true; // true : Your app handle wait screen. false: Diyalog will handle wait screen\n\n\nDiyalogEngine.diyalogInstance().startAnonymousOnlineHelp(\n    customerId: customerId,\n    customerName : customerName,\n    idNumber : customerIdNo,\n    customerPhone : customerPhoneNumber,\n    email : customerEmail,\n    helpType : helpType,\n    transactionHash : transactionHash,\n    isLoggedIn : isLoggedIn,\n    isBackground : isBackground,\n    waitDisplayText: waitDisplayText,\n    result: { (success, error) in\n    if(success)\n    {\n        print("Success")\n        self.showWait()\n        \n        DiyalogEngine.diyalogInstance().subscribeToOnlineHelpChatStateEvent(listener: {(chatState : String?) -> Void in\n            if chatState != nil {\n                print("Online help chat state changed to " + chatState!)\n                \n                // Online help states\n                //"NO_CHAT"           : Default and initial value. There is no active chat\n                //"STARTED"           : Online help started and Diyalog wait screen is shwing. If you handle wait screen, this state will not return.\n                //"CHAT_INPROGRESS"   : Agent ve customer started to conversation.\n                //"CHAT_ENDED"        : Conversation completed.\n\n                if (chatState == "CHAT_ENDED"){\n                    DiyalogEngine.diyalogInstance().unsubscribeToOnlineHelpChatStateEvent()\n                    self.showStartAgain()\n                }\n            }\n        })\n    }else{\n        print("there is an error. ErrCode : \\(String(describing: error?.getCode())). Error Msg: \\(String(describing: error?.getMsg()))")\n    }\n})\n')),Object(o.b)("p",null,"If ",Object(o.b)("strong",{parentName:"p"},"startAnonymousOnlineHelp")," method return successfull and you showed wait screen to customer and the customer press cancel button in your wait screen before agent start online help, you should call ",Object(o.b)("strong",{parentName:"p"},"closeMessaging")," method to stop process"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-jsx"},"DiyalogEngine.diyalogInstance().closeMessaging();\n")),Object(o.b)("p",null,"Done :)  "),Object(o.b)("p",null,"You can download full simple online help android project from ",Object(o.b)("a",{parentName:"p",href:"https://web.diyalog.im/app/pkgs/demoapps/SimpleOnlineHelp_IOS.zip"},"SimpleOnlineHelp")," link."))}y.isMDXComponent=!0}}]);